#!/usr/bin/env php
<?php

use jæm3l\CliNote\CliNote;
use jæm3l\CliNote\Slide\CodeSlide;
use jæm3l\CliNote\Slide\ImageSlide;
use jæm3l\CliNote\Slide\ListSlide;
use jæm3l\CliNote\Slide\ProcessSlide;
use jæm3l\CliNote\Slide\TextSlide;
use jæm3l\CliNote\Slide\TitleSlide;

require dirname(__DIR__).'/vendor/autoload.php';

const CONSOLE_APPS = '/home/christopher/Talks/Better\\ Console\\ Applications/SymfonyWorld2020/slidedeck';
const CONSOLE_EXAMPLE = '/home/christopher/Talks/Better\\ Console\\ Applications/console-example';
const CONSOLE_EXAMPLE_2 = '/home/christopher/Talks/Better\\ Console\\ Applications/console-example-2';
const CONSOLE_EXAMPLE_3 = '/home/christopher/Talks/Better\\ Console\\ Applications/console-example-3';
const CONSOLE_EXAMPLE_4 = '/home/christopher/Talks/Better\\ Console\\ Applications/console-example-4';
const CONSOLE_FLEX = '/home/christopher/Talks/Better\\ Console\\ Applications/flex';

ListSlide::setHeadlineFont(dirname(__DIR__).'/fonts/Doom.flf');
ListSlide::setBulletPointFont(dirname(__DIR__).'/fonts/Stick Letters.flf');
TitleSlide::setDefaultTitleFont(dirname(__DIR__).'/fonts/Doom.flf');
TitleSlide::setDefaultSubtitleFont(dirname(__DIR__).'/fonts/Small.flf');

$cliNote = new CliNote(
    // Title
    new TitleSlide('Better  Console'.PHP_EOL.'Applications', 'Christopher  Hertel'.PHP_EOL.'SymfonyWorld 2020'),
    new Slides\PersonaSlide(),

    // Intro
    new Slides\SectionTitleSlide('Agenda'),
    new Slides\ContrastTitleSlide('Console'.PHP_EOL.'Applications'),
    new Slides\ContrastTitleSlide('Console'.PHP_EOL.'Commands'),
    new Slides\SymfonySlide(),
    new Slides\ContrastTitleSlide('Example'.PHP_EOL.'Application'),
    new ImageSlide(dirname(__DIR__).'/images/hacking.gif'),

    // Console Component
    new Slides\SectionTitleSlide('Console'.PHP_EOL.'Component'),
    new Slides\ContrastTitleSlide('CLI  Application'.PHP_EOL.'Framework'),
    new Slides\ContrastTitleSlide('CLI'.PHP_EOL.'SAPI'),
    //new CodeSlide(dirname(__DIR__).'/code/cli-sapi-examples/cli-1.php'),
    //new CodeSlide(dirname(__DIR__).'/code/cli-sapi-examples/cli-2.php'),
    new CodeSlide(dirname(__DIR__).'/code/cli-sapi-examples/cli-3.php'),
    //new CodeSlide(dirname(__DIR__).'/code/cli-sapi-examples/cli-4.php'),
    //new CodeSlide(dirname(__DIR__).'/code/cli-sapi-examples/cli-5.php'),
    new CodeSlide(dirname(__DIR__).'/code/cli-sapi-examples/cli-6.php'),
    new CodeSlide(dirname(__DIR__).'/code/cli-sapi-examples/cli-7.php'),
    new CodeSlide(dirname(__DIR__).'/code/cli-sapi-examples/cli-8.php'),
    new Slides\ContrastTitleSlide('symfony/console'),
    new Slides\ContrastTitleSlide('symfony/console', 'ca. 250.000.000  Downloads', null, dirname(__DIR__).'/fonts/Straight.flf'),
    new Slides\BashTitleSlide('Installation', '$ composer  require  symfony/console'),

    new Slides\SectionTitleSlide('Application'),
    new CodeSlide(dirname(__DIR__).'/code/app'),
    new Slides\ContrastTitleSlide('chmod + x'),
    //new TextSlide(dirname(__DIR__).'/text/app-output'),
    new ProcessSlide('app', CONSOLE_APPS.'/code/app --ansi'),
    new Slides\SectionTitleSlide('Command'),
    new CodeSlide(dirname(__DIR__).'/code/ExampleCommand.php', 0, null, 90),
    new CodeSlide(dirname(__DIR__).'/code/app-command'),
    new ProcessSlide('app', escapeshellarg(dirname(__DIR__)).'/code/app-command --ansi'),
    new ProcessSlide('app hello', escapeshellarg(dirname(__DIR__)).'/code/app-command hello --ansi'),
    new Slides\ContrastTitleSlide('Use Symfony Flex', 'In case you have more dependencies'),
    new Slides\BashTitleSlide('Installation', '$ symfony  new  console-app'),
    new CodeSlide(dirname(__DIR__).'/code/console'),
    new ProcessSlide('bin/console', CONSOLE_FLEX.'/bin/console --ansi'),
    new ProcessSlide('bin/console hello', CONSOLE_FLEX.'/bin/console hello --ansi'),

    // Tool-Tip Collision
    //new Slides\TodoSlide('Tool-Tip  Collision'),                                   // @TODO FIXME

    // Application Types
    new Slides\SectionTitleSlide('Application'.PHP_EOL.'Types'),
    new Slides\ContrastTitleSlide('Background'.PHP_EOL.'Jobs'),
    ListSlide::withHeadline('Background  Jobs', [
        'Running  In  Background',
    ]),
    ListSlide::withHeadline('Background  Jobs', [
        'Running  In  Background',
        'No  Interaction',
    ]),
    ListSlide::withHeadline('Background  Jobs', [
        'Running  In  Background',
        'No  Interaction',
        'Controlled  By  Server',
    ]),
    ListSlide::withHeadline('Background  Jobs', [
        'Running  In  Background',
        'No  Interaction',
        'Controlled  By  Server',
        'e.g.  Queue  Workers',
    ]),
    new Slides\ContrastTitleSlide('Development'.PHP_EOL.'Helper'),
    ListSlide::withHeadline('Development  Helper', [
        'Running  In  Foreground',
    ]),
    ListSlide::withHeadline('Development  Helper', [
        'Running  In  Foreground',
        'Interaction  Possible',
    ]),
    ListSlide::withHeadline('Development  Helper', [
        'Running  In  Foreground',
        'Interaction  Possible',
        'Controller  By  User',
    ]),
    ListSlide::withHeadline('Development  Helper', [
        'Running  In  Foreground',
        'Interaction  Possible',
        'Controller  By  User',
        'e.g.  Code  Generator'.PHP_EOL.'   or  Debugging  Commands',
    ]),
    new Slides\ContrastTitleSlide('Hybrid'.PHP_EOL.'Tools'),
    ListSlide::withHeadline('Hybrid  Tools', [
        'Combining  Both',
    ]),
    ListSlide::withHeadline('Hybrid  Tools', [
        'Combining  Both',
        'w/  Or  w/o  Interaction',
    ]),
    ListSlide::withHeadline('Hybrid  Tools', [
        'Combining  Both',
        'w/  Or  w/o  Interaction',
        'Used  While  Development',
    ]),
    ListSlide::withHeadline('Hybrid  Tools', [
        'Combining  Both',
        'w/  Or  w/o  Interaction',
        'Used  While  Development',
        'e.g.  Composer  or  PHPUnit',
    ]),
    new Slides\ContrastTitleSlide('But ...', 'We   rarely   build'.PHP_EOL.'hybrid   tools'),
    new Slides\ContrastTitleSlide('First  Question', 'Who  executes  this  command?'),

    // Example Application
    new Slides\SectionTitleSlide('Example  Application'),
    new Slides\ContrastTitleSlide('Billing   Run'),
    ListSlide::withHeadline('Billing   Run', [
        'Generate  Invoices',
    ]),
    ListSlide::withHeadline('Billing   Run', [
        'Generate  Invoices',
        'Charge  payment',
    ]),
    ListSlide::withHeadline('Billing   Run', [
        'Generate  Invoices',
        'Charge  payment',
        'Generate  PDF',
    ]),
    ListSlide::withHeadline('Billing   Run', [
        'Generate  Invoices',
        'Charge  payment',
        'Generate  PDF',
        'Mail  To  Customer',
    ]),
    ListSlide::withHeadline('Billing   Run', [
        'Generate  Invoices',
        'Charge  payment',
        'Generate  PDF',
        'Mail  To  Customer',
        'Export  Postal  Data',
    ]),
    ListSlide::withHeadline('Execution   Details', [
        'Console Command',
    ]),
    ListSlide::withHeadline('Execution   Details', [
        'Console Command',
        'Executed monthly',
    ]),
    ListSlide::withHeadline('Execution   Details', [
        'Console Command',
        'Executed monthly',
        'Executed manually',
    ]),
    new CodeSlide(dirname(__DIR__).'/code/billing-run-kickoff.php'),
    new ProcessSlide('bin/console app:billing:run 11-2020', CONSOLE_EXAMPLE.'/bin/console app:billing:run 11-2020 --ansi'),
    new Slides\ContrastTitleSlide('It\'s  working!'),
    new Slides\ContrastTitleSlide('It\'s  working!', 'But  . . .  umm'),
    new Slides\ContrastTitleSlide('It\'s  working!', 'But  . . .  umm'.PHP_EOL.'Let\'s  refactor'),
    new Slides\SectionTitleSlide('Testing'),
    new Slides\ContrastTitleSlide('ApplicationTester'.PHP_EOL.'CommandTester'),
    new Slides\ContrastTitleSlide('Helper Classes', 'Provided  by  Symfony'.PHP_EOL.'to  execute  an'.PHP_EOL.'Application  or  Command'),
    new Slides\ContrastTitleSlide('Helper Classes', 'Easily  combined  with'.PHP_EOL.'Kernel Test Case'),
    new CodeSlide(dirname(__DIR__).'/code/billing-run-test.php', 20, 30),
    new ProcessSlide('bin/phpunit', CONSOLE_EXAMPLE.'/bin/phpunit -c '.CONSOLE_EXAMPLE.'/phpunit.xml.dist'),

    // Input Interaction
    new Slides\SectionTitleSlide('Input'.PHP_EOL.'Interaction'),
    new CodeSlide(dirname(__DIR__).'/code/billing-run-kickoff.php', 60, 34),
    new CodeSlide(dirname(__DIR__).'/code/CommandInterface-small.php', 0, null, 100),
    new CodeSlide(dirname(__DIR__).'/code/CommandInterface-large.php', 0, null, 100),
    new CodeSlide(dirname(__DIR__).'/code/billing-run-input.php', 65, 35),

    // Console Events
    new Slides\SectionTitleSlide('Console'.PHP_EOL.'Events'),
    ListSlide::withHeadline('Console Events', [
        'console . command',
    ]),
    ListSlide::withHeadline('Console Events', [
        'console . command',
        'console . error',
    ]),
    ListSlide::withHeadline('Console Events', [
        'console . command',
        'console . error',
        'console . terminate',
    ]),
    ListSlide::withHeadline('Console Events', [
        'Console Command Event',
        'Console Error Event',
        'Console Terminate Event',
    ]),
    new ImageSlide(dirname(__DIR__).'/images/events.png'),
    new ProcessSlide('Cheating ...', 'eog --fullscreen '.CONSOLE_APPS.'/images/events.png'),
    new CodeSlide(dirname(__DIR__).'/code/billing-run-input-2.php', 65, 30),
    new CodeSlide(dirname(__DIR__).'/code/StopwatchListener.php', 10, null, 90),
    new CodeSlide(dirname(__DIR__).'/code/billing-run-listener.php', 65, 21),
    new ProcessSlide('bin/console app:billing:run 11-2020', CONSOLE_EXAMPLE.'/bin/console app:billing:run 11-2020 --ansi'),

    // Command == Glue Code
    new Slides\SectionTitleSlide('Command'.PHP_EOL.'   ==  Glue  Code'),
    new Slides\ContrastTitleSlide('Golden Rule', 'No  Business  Logic'.PHP_EOL.'In  A  Command'),
    new CodeSlide(dirname(__DIR__).'/code/billing-run-listener.php', 65, 21),
    new CodeSlide(dirname(__DIR__).'/code/billing-run-listener.php', 120, 22),
    new Slides\ContrastTitleSlide('Move  Business'.PHP_EOL.'Logic  To  Service'),
    new CodeSlide(dirname(__DIR__).'/code/billing-run-logic.php', 22, 31),
    new CodeSlide(dirname(__DIR__).'/code/BillingRun.php', 15, 31),
    new Slides\ContrastTitleSlide('Cleaner'.PHP_EOL.'Dependencies'),
    new Slides\ContrastTitleSlide('Easier  Testing'),

    // Tool-Tip PHPBench
    //new Slides\TodoSlide('Tool-Tip  PHPBench'),                                 // @TODO FIXME

    // Output
    new Slides\SectionTitleSlide('Output'),
    new CodeSlide(dirname(__DIR__).'/code/billing-run-logic.php', 22, 31),
    new CodeSlide(dirname(__DIR__).'/code/BillingRun.php', 13, 33),
    new Slides\ContrastTitleSlide('But, really?', 'BillingRun   Depends   On'.PHP_EOL.'Symfony\\Component\\Console'),
    new Slides\ContrastTitleSlide('Next Step', 'Decouple   Business   Logic'.PHP_EOL.'From   Framework'),

    // Tool-Tip deptrac
    //new Slides\TodoSlide('Tool-Tip  deptrac'),                                  // @TODO FIXME

    // Logging
    new Slides\SectionTitleSlide('Logging'),
    new Slides\ContrastTitleSlide('Perfect  for'.PHP_EOL.'Background  Jobs'),
    new CodeSlide(dirname(__DIR__).'/code/BillingRunLogging.php', 15, 34),
    new ProcessSlide('bin/console app:billing:run 11-2020', CONSOLE_EXAMPLE_2.'/bin/console app:billing:run 11-2020 --ansi'),
    new Slides\ContrastTitleSlide('Verbosity  Level'),
    ListSlide::withHeadline('Quite', [
        '-q  Or  --quiet',
    ]),
    ListSlide::withHeadline('Quite', [
        '-q  Or  --quiet',
        'No  Output',
    ]),
    ListSlide::withHeadline('Quite', [
        '-q  Or  --quiet',
        'No  Output',
        'Log  Level:  From  Error',
    ]),
    ListSlide::withHeadline('Normal', [
        'All  Output',
    ]),
    ListSlide::withHeadline('Normal', [
        'All  Output',
        'Log  Level:  From  Warning',
    ]),
    ListSlide::withHeadline('Verbose', [
        '-v',
    ]),
    ListSlide::withHeadline('Verbose', [
        '-v',
        'All  Output',
    ]),
    ListSlide::withHeadline('Verbose', [
        '-v',
        'All  Output',
        'Log  Level:  From  Notice',
    ]),
    ListSlide::withHeadline('Very  Verbose', [
        '-vv',
    ]),
    ListSlide::withHeadline('Very  Verbose', [
        '-vv',
        'All  Output',
    ]),
    ListSlide::withHeadline('Very  Verbose', [
        '-vv',
        'All  Output',
        'Log  Level:  From  Info',
    ]),
    ListSlide::withHeadline('Debug', [
        '-vvv',
    ]),
    ListSlide::withHeadline('Debug', [
        '-vvv',
        'All  Output',
    ]),
    ListSlide::withHeadline('Debug', [
        '-vvv',
        'All  Output',
        'All  Log  Levels'.PHP_EOL.'   And  Extended  Context',
    ]),
    new ProcessSlide('bin/console app:billing:run 11-2020 -vv', CONSOLE_EXAMPLE_2.'/bin/console app:billing:run 11-2020 -vv --ansi'),
    new ProcessSlide('bin/console app:billing:run 11-2020 -vvv', CONSOLE_EXAMPLE_2.'/bin/console app:billing:run 11-2020 -vvv --ansi'),

    // Logging
    new Slides\SectionTitleSlide('Output'),
    new Slides\ContrastTitleSlide('ProgressBar?'),
    new Slides\ContrastTitleSlide('Callable', 'The  Easy  Way  Out'),
    new CodeSlide(dirname(__DIR__).'/code/BillingRunCallable.php', 33, 25),
    new CodeSlide(dirname(__DIR__).'/code/billing-run-callable.php', 40, 24),
    new Slides\ContrastTitleSlide('Glue  Code', 'Like   Custom   Observer'),
    new ProcessSlide('bin/console app:billing:run 11-2020', CONSOLE_EXAMPLE_3.'/bin/console app:billing:run 11-2020 --ansi'),

    // Features
    new Slides\SectionTitleSlide('Features'),
    new Slides\SectionTitleSlide('SymfonyStyle'),
    new Slides\ContrastTitleSlide('SymfonyStyle', 'Helper  Class  On  Top'.PHP_EOL.'Of  Input  &  Output'),
    new CodeSlide(dirname(__DIR__).'/code/symfony-style.php', 6),
    //new ProcessSlide('Cheating again...', 'eog --fullscreen '.CONSOLE_APPS.'/images/style.png'),
    new TextSlide(dirname(__DIR__).'/text/symfony-style-output'),

    new Slides\SectionTitleSlide('Sections'),
    new CodeSlide(dirname(__DIR__).'/code/section.php', 0, null, 90),
    new Slides\SectionSlide(),
    new ProcessSlide('bin/console app:billing:run 11-2020', CONSOLE_EXAMPLE_4.'/bin/console app:billing:run 11-2020 --ansi'),

    new Slides\SectionTitleSlide('Cursor'.PHP_EOL.'Since  v 5.1'),
    new CodeSlide(dirname(__DIR__).'/code/cursor.php', 0, null, 90),
    new Slides\SnakeSlide(),

    new Slides\SectionTitleSlide('Color'.PHP_EOL.'Since  v 5.2'),
    new CodeSlide(dirname(__DIR__).'/code/color.php', 0, null, 90),
    new ImageSlide(dirname(__DIR__).'/images/sympony.jpeg'),
    new Slides\GradientSlide(),

    new Slides\SectionTitleSlide('Signals'.PHP_EOL.'Since  v 5.2'),
    new CodeSlide(dirname(__DIR__).'/code/signal-cmd.php', 0, null, 90),
    ListSlide::withHeadline('Console Events', [
        'console . command',
        'console . error',
        'console . terminate',
    ]),
    ListSlide::withHeadline('Console Events', [
        'console . command',
        'console . error',
        'console . terminate',
        'console . signal',
    ]),
    new CodeSlide(dirname(__DIR__).'/code/signal-listener.php', 0, null, 80),

    // Outro
    new Slides\OutroSlide('   The  End', 'fruit'),
    new Slides\OutroSlide('Thank  You', 'instagram'),
    new Slides\OutroSlide('Questions?', 'teen'),
);
$cliNote->run();
